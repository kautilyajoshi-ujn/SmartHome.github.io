
/* addons/shared_addons/modules/dealer_locator/js/dealer-locator-jbl.js */

;$(function(){var lastSearchcoords=undefined;var lastSearchType='location';var lastIncludeDistance=false;var nextDealerLazyPage=1;var search_method='location';var coords;var apiService=(sr=='cn')?'baidu':'google';var $submitButtons=$('.location-search-button');var existingCsDealers=[];var usedGetMyLocation=false;var usedQueryStringSearch=false;var getMyLocationLat=0;var getMyLocationLng=0;if(!navigator.permissions){$('#get-my-location-container').mkShowThis();}
else{navigator.permissions.query({name:'geolocation'}).then(function(result){if(result.state!=='denied'){$('#get-my-location-container').mkShowThis();}});}
$('.what-are-link').click(function(e){var $this=$(this);if($($this.data('toggle')).css('display')=='none'){analyticsTrack({"tealium_event":$this.data('track-label'),"language_code":utag_data.language_code,"country_code":utag_data.country_code,"page_name":utag_data.page_name,"page_uri":utag_data.page_uri,"link_category":"Dealer locator","link_action":$this.data('track-label'),});}});if($('#showroom-locator-form').length>0){$('#showroom-locator-form').submit(function(){initialSearch=(search_method=='dealer-name')?$('.name-search-fields').val():$('.location-search-fields').val();doSearch();return false;});}
if($('#showroom-locator-form-sticky').length>0){$('#showroom-locator-form-sticky').submit(function(){initialSearch=(search_method=='dealer-name')?$('.name-search-fields').val():$('.location-search-fields').val();doSearch();return false;});}
var $locationSearchFields=$('.location-search-fields');$locationSearchFields.keyup(function(){$locationSearchFields.val($(this).val());});var $countrySelectboxes=$('.country-selectbox');$countrySelectboxes.change(function(){$countrySelectboxes.val(this.value);});var $nameSearchFields=$('.name-search-fields');$nameSearchFields.change(function(){$nameSearchFields.val($(this).val());});if(sr=='cn'||sr=='de'){$countrySelectboxes.val(sr.toUpperCase());}
var url_city=getParameterByName('city');var url_state=getParameterByName('state');var url_zip_code=getParameterByName('zip_code');var url_country=getParameterByName('country');var url_search='';url_search+=url_city?(url_city+' '):'';url_search+=url_state?(url_state+' '):'';url_search+=url_zip_code?(url_zip_code+' '):'';if(url_country){if(url_country.length>2){$('#selected-country option').each(function(){if(($(this).text()).toLowerCase()==url_country.toLowerCase()){$countrySelectboxes.val($(this).val());}});}
else{$countrySelectboxes.val(url_country);}}
if(url_city||url_state||url_zip_code){$locationSearchFields.val(url_search);initialSearch=url_search;usedQueryStringSearch=true;doSearch(url_search);}
function getParameterByName(name){name=name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return results==null?"":decodeURIComponent(results[1].replace(/\+/g," "));}
if($('#switch-search-type').length>0){$('#switch-search-type').click(function(){formRevalidate($(this));});}
if($('#switch-search-type-sticky').length>0){$('#switch-search-type-sticky').click(function(){formRevalidate($(this));});}
function formRevalidate(triggeredSearchType){var locationSearchFormRequired;var nameSearchFormRequired;var searchField;var placeholderText;if(search_method=='dealer-name'){search_method='location';locationSearchFormRequired=true;nameSearchFormRequired=false;searchField='location-search';placeholderText=trnsl_search_by_dealer_name_placeholder;$('.location-search').removeClass('hidden');$('.name-search').addClass('hidden');}
else{search_method='dealer-name';locationSearchFormRequired=false;nameSearchFormRequired=true;searchField='name-search';placeholderText=trnsl_search_by_location_placeholder;$('.location-search').addClass('hidden');$('.name-search').removeClass('hidden');}
$('#selected-country').prop('required',locationSearchFormRequired);$('#location-search').prop('required',locationSearchFormRequired);$('#name-search').prop('required',nameSearchFormRequired);$('#'+searchField+(triggeredSearchType.attr('id')=='switch-search-type-sticky'?'-sticky':'')).focus();$('#switch-search-type').html(placeholderText);$('#showroom-locator-form').validateForm();$('#selected-country-sticky').prop('required',locationSearchFormRequired);$('#location-search-sticky').prop('required',locationSearchFormRequired);$('#name-search-sticky').prop('required',nameSearchFormRequired);$('#switch-search-type-sticky').html(placeholderText);$('#showroom-locator-form-sticky').validateForm();}
if($('#get-my-location').length>0){$('#get-my-location').click(function(){nextDealerLazyPage=1;nextCertifiedShowroomDealerLazyPage=1;initialSearch='';search_method='location';lastSearchType='location';$('#name-search').prop('required',false);$('#selected-country').prop('required',true);$('#location-search').prop('required',true);$('.location-search').removeClass('hidden');$('.name-search').addClass('hidden');$('#showroom-locator-form-sticky').validateForm();$('#switch-search-type').html(trnsl_search_by_dealer_name_placeholder);$('#name-search-sticky').prop('required',false);$('#selected-country-sticky').prop('required',true);$('#location-search-sticky').prop('required',true);$('#showroom-locator-form-sticky').validateForm();$('#switch-search-type-sticky').html(trnsl_search_by_dealer_name_placeholder);$('#alert-not-found').mkHideThis();var locationButton=$('#get-my-location');locationButton.data('original-text',locationButton.html());locationButton.html('<i class="fal fa-circle-notch fa-spin" aria-hidden="true"></i>');geolocate();});}
if(mobileBrowser&&!url_zip_code){geolocate();}
function geolocate(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){coords={"lat":position.coords.latitude,"lng":position.coords.longitude};getMyLocationLat=position.coords.latitude;getMyLocationLng=position.coords.longitude;console.log("html5 success "+coords['lat']+","+coords['lng']);getAddress(coords['lat'],coords['lng']);},errorCallback,{enableHighAccuracy:true,timeout:20000,maximumAge:0});}
else{document.getElementById('scroll-to-results').scrollIntoView({behavior:'smooth'});$('#get-my-location').mkHideThis();$('#alert-not-found').mkShowThis();$('#location-search').select();}}
function errorCallback(p){console.log(p.message);if(apiService=='google'){$.ajax({url:"https://www.google.com/jsapi",success:function(){if(google.loader.ClientLocation){coords={"lat":google.loader.ClientLocation.latitude,"lng":google.loader.ClientLocation.longitude};getMyLocationLat=google.loader.ClientLocation.latitude;getMyLocationLng=google.loader.ClientLocation.longitude;getAddress(coords['lat'],coords['lng']);}else{document.getElementById('scroll-to-results').scrollIntoView({behavior:'smooth'});$('#get-my-location').mkHideThis();$('#alert-not-found').mkShowThis();$('#location-search').select();}}});}
else{document.getElementById('scroll-to-results').scrollIntoView({behavior:'smooth'});$('#get-my-location').mkHideThis();$('#alert-not-found').mkShowThis();$('#location-search').select();}}
function getAddress(lat,long){usedGetMyLocation=true;if(apiService=="baidu"){$.ajax({url:"https://api.map.baidu.com/geocoder/v2/?ak=GW8qAThynFWhndcpPGHZlcnRRoKEvVyg&location="+coords['lat']+","+coords['lng']+"&output=json&pois=1&s=1",type:"POST",dataType:'jsonp',success:function(data){console.log('getAddress Baidu');displayAddress(data);},timeout:8000,error:function(jqXHR,textStatus,errorThrown){if(textStatus==="timeout"){document.getElementById('scroll-to-results').scrollIntoView({behavior:'smooth'});$('#alert-not-found').mkShowThis();}}});}
else{$.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json?address="+coords['lat']+"+"+coords['lng']+'&key='+encodeURIComponent(googleMapsApiKey)+"&sensor=false",success:function(data){console.log('getAddress Google');if(typeof(data.error_message)!=='undefined'){console.error('Google Maps API Error 1: '+data.error_message);$('#get-my-location').data('original-text',$('#get-my-location').html());}
else{displayAddress(data);}},timeout:4000,error:function(jqXHR,textStatus,errorThrown){if(textStatus==="timeout"){apiService='baidu';getAddress();}}});}}
function displayAddress(data){var formattedAddress=undefined;var country=undefined;coords['dealer_result_set']=ALL_DEALERS;if(apiService=="baidu"){console.table(data);formattedAddress=(data.result.formatted_address!="")?data.result.formatted_address:data.result.addressComponent.street+", "+data.result.addressComponent.city+", "+data.result.addressComponent.province;country=data.result.addressComponent.country;}else{data.results.forEach(function(result){if(formattedAddress==undefined&&result["formatted_address"]){formattedAddress=result["formatted_address"];}
result.address_components.forEach(function(address_component){address_component.types.forEach(function(type){if(country==undefined&&type=="country"){country=address_component.long_name;}});});});}
$('#location-search').val(formattedAddress);$('#location-search-sticky').val(formattedAddress);$('#selected-country').find('option').each(function(index,element){if(element.innerHTML==country){$('#selected-country').val(element.value);$('#selected-country-sticky').val(element.value);return;}});$('#get-my-location').html($('#get-my-location').data('original-text'));performSearchPopulateDealers(coords,true);}
function doSearch(manual_search){var location='';lastSearchcoords=undefined;lastSearchType='location';lastIncludeDistance=false;nextDealerLazyPage=1;nextCertifiedShowroomDealerLazyPage=1;coords={};coords['dealer_result_set']=ALL_DEALERS;$('#alert-not-found').mkHideThis();$submitButtons.html('<i class="fal fa-circle-notch fa-spin" aria-hidden="true"></i>');if(search_method=='location'){if(typeof(manual_search)!='undefined'){location=manual_search+' ';}
else if($('#location-search').val().trim()){location=$('#location-search').val()+' ';}
location+=$('#selected-country option:selected').text();if(apiService=="baidu"){$.ajax({url:"https://api.map.baidu.com/geocoder/v2/?ak=GW8qAThynFWhndcpPGHZlcnRRoKEvVyg&address="+encodeURIComponent(location).replace("%2C%20","+").replace("%20","+")+"&output=json&pois=1&s=1",dataType:'jsonp',success:function(data){if(data&&data.result){lat_long=data.result.location;coords={"lat":lat_long.lat,"lng":lat_long.lng,"country":$('#selected-country').val(),"page":0,};getMyLocationLat=lat_long.lat;getMyLocationLng=lat_long.lng;performSearchPopulateDealers(coords,true);}
else{document.getElementById('scroll-to-results').scrollIntoView({behavior:'smooth'});$('#alert-not-found').mkShowThis();$('#location-search').select();$submitButtons.html('<i class="fal fa-search"></i>');}},timeout:10000,error:function(jqXHR,textStatus,errorThrown){if(textStatus==="timeout"){console.log("baidu maps api timed-out");$submitButtons.html('<i class="fal fa-search"></i>');}}});}
else{$.ajax({url:'https://maps.googleapis.com/maps/api/geocode/json?address='+encodeURIComponent(location)+'&key='+encodeURIComponent(googleMapsApiKey)+'&sensor=false',success:function(data){var lat_long={};if(data.results.length>0){lat_long=data.results[0].geometry.location;coords={"lat":lat_long.lat,"lng":lat_long.lng,"page":0,};if(typeof(manual_search)!='undefined'&&(!url_country||url_country.length==0)&&data.results[0].address_components.length>0){coords['country']=country=getCountry(data.results[0].address_components);$countrySelectboxes.val(country);}
else{coords['country']=$('#selected-country').val();}
performSearchPopulateDealers(coords,true);}
else if(typeof(data.error_message)!=='undefined'){console.log('Google Maps API Error 2: '+data.error_message);$submitButtons.html('<i class="fal fa-search"></i>');}
else{document.getElementById('scroll-to-results').scrollIntoView({behavior:'smooth'});$('#alert-not-found').mkShowThis();$('#location-search').select();$submitButtons.html('<i class="fal fa-search"></i>');}},timeout:4000,error:function(jqXHR,textStatus,errorThrown){if(textStatus==="timeout"){document.getElementById('scroll-to-results').scrollIntoView({behavior:'smooth'});$('#alert-not-found').mkShowThis();$('#location-search').select();$submitButtons.html('<i class="fal fa-search"></i>');}}});}}
else if(search_method=='dealer-name'){if($('#name-search').val()){lastSearchType='name';coords={"dealer_name":$('#name-search').val(),};performSearchPopulateDealers(coords,false);}}}
function performSearchPopulateDealers(coords,include_distance){lastSearchcoords=coords;lastIncludeDistance=include_distance;existingCsDealers=[];$.post('/dealer_locator/query',coords,function(data){if((data.certified_showroom_dealers&&data.certified_showroom_dealers.length>0)||((data.all_dealers&&data.all_dealers.length>0)||(data.certified_showroom_dealers&&data.certified_showroom_dealers.length>0))){$('#sticky-form').removeClass('hidden');var total=0;$('#certified-showroom-dealer-results').empty();$('#dealer-results').empty();$('#certified-showroom-dealer-results-container').addClass('hidden');$('#dealer-results-container').addClass('hidden');if(data.certified_showroom_dealers&&data.certified_showroom_dealers.length>0){total+=data.certified_showroom_dealers.length;analyticsTrack({"tealium_event":"Number of showrooms returned","language_code":utag_data.language_code,"country_code":utag_data.country_code,"page_name":utag_data.page_name,"page_uri":utag_data.page_uri,"link_category":"Dealer locator","link_action":"Number of showrooms returned","search_country":$('.country-selectbox').val(),"search_results":data.certified_showroom_dealers.length,"search_location":(usedGetMyLocation?'lat='+getMyLocationLat+', long='+getMyLocationLng:initialSearch)});$('#certified-showroom-dealer-results-container').removeClass('hidden');}
if(data.all_dealers&&data.all_dealers.length>0){total+=data.all_dealers.length;$('#dealer-results-container').removeClass('hidden');}
var searchType=lastSearchType;if(usedGetMyLocation){searchType='Get my location';}
else if(search_method=='dealer-name'){searchType='Search by dealer name';}
else if(usedQueryStringSearch){searchType='Query string';}
else{searchType='Search';}
analyticsTrack({"tealium_event":searchType,"language_code":utag_data.language_code,"country_code":utag_data.country_code,"page_name":utag_data.page_name,"page_uri":utag_data.page_uri,"link_category":"Dealer locator","link_action":searchType,"search_country":$('.country-selectbox').val(),"search_results":total,"search_location":(usedGetMyLocation?'lat='+getMyLocationLat+', long='+getMyLocationLng:initialSearch)});usedGetMyLocation=false;getMyLocationLat=0;getMyLocationLng=0;showDealerMap(data.certified_showroom_dealers,data.all_dealers);appendDealerResultsTable(data,include_distance,false);$('#original-content').addClass('hidden');$('.hide-after-search').mkHideThis();$('.search-container').animate({paddingBottom:0,},1000,'easeInOutQuint');$('#get-my-location').html($('#get-my-location').data('original-text'));document.getElementById('scroll-to-results').scrollIntoView({behavior:'smooth'});}
else{alert("No results found. Please try another search.");}
$submitButtons.html('<i class="fal fa-search"></i>');});}
function showDealerMap(certified_dealers,all_dealers){if(apiService=='google'){var longitudes=new Array();var latitudes=new Array();var markers=new Array();var totalLatitude=0;var totalLongitude=0;var data_length=0;if(Array.isArray(certified_dealers)){certified_dealers.forEach(function(element){longitudes.push(element.longitude);latitudes.push(element.latitude);totalLatitude+=element.latitude;totalLongitude+=element.longitude;if(!element.isAddressHidden){var address=formatAddress(element);markers.push({marker:{position:new google.maps.LatLng(element.latitude,element.longitude),title:element.dealerName,icon:element.pinIcon,optimized:false,zIndex:9999},infoWindow:{content:'<div id="content"><div id="siteNotice"></div>'+'<h2 id="first-heading">'+element.dealerName+'</h2>'+'<div id="body-content">'+
address+'<br><a href="'+((element.url)?element.url:"/dealer_locator/show/id/"+element.dealerId+"/line/"+element.lineNum)+'" target="'+((element.url)?"_blank":"_self")+'">'+trnsl_maps_get_details+'</a>'+'</div>',},});}});data_length+=certified_dealers.length;}
if(Array.isArray(all_dealers)){all_dealers.forEach(function(element){longitudes.push(element.longitude);latitudes.push(element.latitude);totalLatitude+=element.latitude;totalLongitude+=element.longitude;if(!element.isAddressHidden){var address=formatAddress(element);markers.push({marker:{position:new google.maps.LatLng(element.latitude,element.longitude),title:element.dealerName,icon:element.pinIcon,optimized:false},infoWindow:{content:'<div id="content"><div id="siteNotice"></div>'+'<h2 id="first-heading">'+element.dealerName+'</h2>'+'<div id="body-content">'+
address+'<br><a href="'+((element.url)?element.url:"/dealer_locator/show/id/"+element.dealerId+"/line/"+element.lineNum)+'" target="'+((element.url)?"_blank":"_self")+'">'+trnsl_maps_get_details+'</a>'+'</div>',},});}});data_length+=all_dealers.length;}
var maxLongitude=Math.max.apply(null,longitudes);var minLongitude=Math.min.apply(null,longitudes);var maxLatitude=Math.max.apply(null,latitudes);var minLatitude=Math.min.apply(null,latitudes);var range=haversine({latitude:maxLatitude,longitude:maxLongitude},{latitude:minLatitude,longitude:minLongitude},{unit:'mile'});if(range<1)range=1;var myLatlng=new google.maps.LatLng((totalLatitude/data_length),totalLongitude/data_length);var mapOptions={zoom:Math.round(15-Math.log(range)/Math.LN2),center:myLatlng,}
if((!isNaN(mapOptions.zoom))&&(mapOptions.zoom>0)){var map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions);map.setOptions({draggable:true,zoomControl:true,scrollwheel:false,disableDoubleClickZoom:false});var infoWindow=null;var openInfoWindow=-1;markers.forEach(function(marker,index){marker.marker["map"]=map;var maps_marker=new google.maps.Marker(marker.marker);google.maps.event.addListener(maps_marker,'click',function(){if(infoWindow){infoWindow.close();}
if(index!=openInfoWindow){infoWindow=new google.maps.InfoWindow(marker.infoWindow);infoWindow.open(map,maps_marker);openInfoWindow=index;}
else{openInfoWindow=-1;}});});}
if(mobileBrowser){document.getElementById('map-canvas').style.height="200px";}
else{document.getElementById('map-canvas').style.height="300px";}}}
function appendDealerResultsTable(data,include_distance,view_more_list){if(data.certified_showroom_dealers){createResultTable(data.certified_showroom_dealers,(!view_more_list?'certified-showroom-dealer-results':'dealer-results'),include_distance,true,view_more_list);}
if((data.all_dealers&&data.all_dealers.length>0)){createResultTable(data.all_dealers,'dealer-results',include_distance,false,view_more_list);}
if($('#show-next-dealer-set').length>0){$('#show-next-dealer-set').remove();$('#contact-number').remove();}
if(lastSearchType=='location'){var page=nextDealerLazyPage++;$('#dealer-results-container').append("<a id=\"show-next-dealer-set\" class=\"c4btn outline dark a-track\" href=\"javascript:;\" data-next-page=\""+page+"\" data-track-category=\"Dealer locator\" data-track=\"Show more results\" data-track-label=\""+page+"\"><i class=\"fal fa-chevron-down\"></i>"+defaultPageSize+' '+trnsl_view_more_dealers+"</a>");$('#dealer-results-container').append('<small id="contact-number" class="text-right block margin-top" style="right: 25px; bottom: 25px;">'+trnsl_contact_number+'</small>');attachCallAnalytics();}
attachLinkTracking();}
$('#dealer-results-container').on('click','#show-next-dealer-set',function(){$('#show-next-dealer-set').html('<i class="fal fa-circle-notch fa-spin" aria-hidden="true"></i>'+defaultPageSize+trnsl_view_more_dealers);lastSearchcoords['page']=$(this).data('nextPage');lastSearchcoords['existing_cs_dealers']=JSON.stringify(existingCsDealers);lastSearchcoords['dealer_result_set']=ALL_DEALERS;performNextPageDataLoad(lastSearchcoords,'dealers');});function performNextPageDataLoad(post_data){$.post('/dealer_locator/query',post_data,function(data){data=JSON.parse(JSON.stringify(data));if((data.certified_showroom_dealers&&data.certified_showroom_dealers.length>0)||(data.all_dealers&&data.all_dealers.length>0)){appendDealerResultsTable(data,lastIncludeDistance,true);loadingNextPage=false;}
else{alert(trnsl_no_dealers);}}).fail(function(response){alert(trnsl_dealers_error);});}
function createResultTable(data,resultTable,include_distance,is_certified_showroom_results,view_more_list){var use_miles=false;var countries_using_miles=['MM','LR','UK','GB','US',];var header_text=(is_certified_showroom_results)?trnsl_dealer_cs_header:trnsl_dealer_header;is_certified_showroom_results=typeof(is_certified_showroom_results)=='undefined'?false:is_certified_showroom_results;if(countries_using_miles.indexOf($('#selected-country').val())>-1){use_miles=true;units='mi';}
var addressMapsApi=apiService=="baidu"?'http://map.baidu.com/?latlng=':'https://www.google.com/maps/place/';var addressColClass='col-sm-4 col-xs-6';var statusColClass='col-sm-4 col-xs-6';var divBody=$(document.createElement('div')).prop({class:'body'});if(Array.isArray(data)){if((nextDealerLazyPage==1)&&is_certified_showroom_results&&(data.length==0)){$('#'+resultTable).append('<p class="no-events-text" style="margin-top:10px;">'+trnsl_no_csds_found+'</p>');$('#'+resultTable+'-container').removeClass('hidden');}
else{data.forEach(function(element){if(is_certified_showroom_results){existingCsDealers.push(element.dealerId+"-"+element.lineNum);}
var divRow=$(document.createElement('div')).attr('id',element.dealerId+"-"+element.lineNum).prop({class:'row'});if(!element.isAddressHidden){var distance=+(Math.round(parseFloat(element.distance)+"e+2")+"e-2");distance=!use_miles?miles_to_kilometers(distance):distance;var address=formatAddress(element);address+=include_distance?"<br><b>"+distance+" "+(!use_miles?'km':'mi')+"</b> ":'';var formattedAddress=$(document.createElement('div'));var addressHtml=$(document.createElement('span'));var addressLinks=$(document.createElement('span')).prop({class:'address-links'});var addressShowMap=$(document.createElement('a')).attr({href:addressMapsApi+element.latitude+','+element.longitude,title:'Learn More',target:'_blank','data-track-category':'Dealer locator','data-track':'Show on map','data-track-label':element.dealerId+'-'+element.lineNum}).html(trnsl_view_map);addressHtml.append(address);addressLinks.append(addressShowMap);addressHtml.append(addressLinks);formattedAddress.append(addressHtml);}
else{var formattedAddress=$(document.createElement('div')).append($(document.createElement('span')).html(trnsl_contact_to_make_appointment));}
var divStatus=$(document.createElement('div')).prop({class:statusColClass});var badges=(element.isCertifiedShowroom==true)?'<img style="margin-right: 13px;" class="dealer-status-logo" src="https://res.cloudinary.com/control4/image/upload/c_scale,w_60,f_auto,q_100/v1512145430/www/control4/C4-Certified-Badge.png" title="Certified Showroom">':'';badges+='<img style="width: 60px; margin-right: 13px; margin-bottom: 24px" class="dealer-status-logo" src="'+element.statusLogo+'" title="'+element.statusTitle+'">';badges+=(element.isPinnacle==true)?'<img style="margin-right: 13px; margin-bottom: 24px" class="dealer-status-logo" src="https://res.cloudinary.com/control4/image/upload/c_scale,w_60,f_auto,q_100/v1491521679/static-pages/support/c4-badge-pinnacle.png">':'';divStatus.html(badges);divRow.append(divStatus);var divDealer=$(document.createElement('div')).prop({class:addressColClass});var dealerName=$(document.createElement('strong')).prop({class:'text-'+(is_certified_showroom_results?'white':'dark')}).html(element.dealerName);var dealerLink=$(document.createElement('a')).prop({class:'a-track hover-underline'}).attr({href:element.url,target:'_blank','data-track-category':'Dealer locator','data-track':'Learn more','data-track-label':element.dealerId+'-'+element.lineNum});setWebsiteClickEvent(dealerLink,element,is_certified_showroom_results);dealerLink.append(dealerName);divDealer.append(dealerLink);divDealer.append(formattedAddress);divRow.append(divDealer);var websiteContainer=$(document.createElement('div')).prop({class:'col-sm-4'});var websiteLink='';if(typeof(element.url)!='undefined'&&element.url){websiteLink=element.url;}
else{websiteLink="/dealer_locator/show/id/"+element.dealerId+"/line/"+element.lineNum;}
if(element.isCertifiedShowroom){var eventLink=$(document.createElement('a')).prop({class:'c4btn websitebtn block dark-grey a-track'}).css({'margin-top':'10px'}).attr({href:websiteLink,target:'_blank','data-track-category':'Dealer locator','data-track':'Schedule a Visit','data-track-label':element.dealerId+'-'+element.lineNum}).html(trnsl_dealer_cs_rsvp_btn);setWebsiteClickEvent(eventLink,element,is_certified_showroom_results);websiteContainer.append(eventLink);}
learnMoreLink=$(document.createElement('a')).prop({class:'c4btn websitebtn transparent block a-track'}).css({'margin-top':'10px'}).attr({href:websiteLink,target:'_blank','data-track-category':'Dealer locator','data-track':'Learn more','data-track-label':element.dealerId+'-'+element.lineNum}).html(trnsl_website);setWebsiteClickEvent(learnMoreLink,element,is_certified_showroom_results);websiteContainer.append(learnMoreLink);divRow.append(websiteContainer);divBody.append(divRow);});}}
if(view_more_list&&!is_certified_showroom_results){$('#'+resultTable).append('<h3>'+header_text+'</h3>');}
var divTable=$(document.createElement('div')).prop({class:'table no-margin'});divTable.append(divBody);$('#'+resultTable).append(divTable);}
function setWebsiteClickEvent(websiteLink,element,is_certified_showroom_results){websiteLink.on('click',function(e){e.preventDefault();e.stopPropagation();var rowLink=$(this).attr('href');var rowTarget="_blank";var eventLabel=element.dealerId+'-'+element.lineNum;window.open(rowLink,rowTarget);});}
function formatAddress(element){var address="";if(element.address.line1){address+=element.address.line1+"<br>";}
if(element.address.line2){address+=element.address.line2+"<br>";}
if(element.address.city){address+=element.address.city+", ";}
if(element.address.stateProvince){address+=element.address.stateProvince+", ";}
if(element.address.postalCode){address+=element.address.postalCode}
return address;}
function miles_to_kilometers(miles){return+(Math.round(miles*1.60934+"e+2")+"e-2");}
function getCountry(addrComponents){for(var i=0;i<addrComponents.length;i++){if(addrComponents[i].types[0]=="country"){return addrComponents[i].short_name;}
if(addrComponents[i].types.length==2){if(addrComponents[i].types[0]=="political"){return addrComponents[i].short_name;}}}
return-1;}
var toRad=function(num){return num*Math.PI/180}
function haversine(start,end,options){var km=6371;var mile=3960;options=options||{}
var R=options.unit==='mile'?mile:km;var dLat=toRad(end.latitude-start.latitude);var dLon=toRad(end.longitude-start.longitude);var lat1=toRad(start.latitude);var lat2=toRad(end.latitude);var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.sin(dLon/2)*Math.sin(dLon/2)*Math.cos(lat1)*Math.cos(lat2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return R*c;}});
